# Домашнее задание по мини-курсу Intro to System Design

Мягкий дедлайн: **31.10.2023 23:59** (если вы хотите получить фидбек)

Жесткий дедлайн: **03.11.2023 23:59** (если фидбек не нужен, только оценка)

Форма для сдачи: https://docs.google.com/forms/d/1g0mjH8Fjs0PkggluO5f3FQZu_iQGvkmE5D3JfW7oKXA/

## Задание

Вам необходимо разработать сервис для сокращения ссылок (наподобие https://bitly.com/).
Сервис должен предоставлять HTTP API со следующими методами:

* `POST /create?url={url}` – должен сохранить url и вернуть короткий идентификатор в формате JSON `{"id": "123"}`
* `GET /link/{id}` – должен вернуть сохраненную ссылку по идентификатору

Формат идентификатора может быть любым на ваше усмотрение. Он должен выставляться рандомно: 1, 2, 3, ... **не подойдет**,
потому что раскроет пользователям сервиса информацию о том, сколько в нем сохранено ссылок,
а еще позволит легко перебрать их все и посмотреть чужие ссылки.

### Дополнительные требования

Сервис должен запускаться в Docker, быть отказоустойчивым (сохранять данные при перезапуске), поддерживать масштабирование (подробности ниже).

## Оценивание

Весь результат (код, Dockerfile, docker-compose) необходимо сохранить в **приватный** репозиторий на github и добавить karpp
в коллабораторы.

* _4 балла:_ разработать сервис с представленым API, без дополнительных требований
* _6 баллов:_ запустить сервис в докере, добавить в репозиторий Dockerfile для сборки кода
* _8 баллов:_ сделать сервис отказоустойчивым, сохранять данные в базу данных.
В репозиторий добавить файл docker-compose.yml, в котором будут запускаться ваш сервис и БД
* _10 баллов:_ сделать два инстанса вашего сервиса в docker-compose.yml.
Добавить load balancer, который будет распределять нагрузку между ними

## Примечания

### API

Можно выбрать любой язык / фреймворк, который вам нравится, но рекомендуется (и проще всего) взять Python и FastAPI.
Документация по нему есть здесь: https://fastapi.tiangolo.com/tutorial/
(вам понадобятся First Steps, Path Parameters, Query Parameters).

### База данных

В качестве базы данных рекомендуется использовать _Redis_.

Docker образ: https://hub.docker.com/_/redis.

Python клиент: https://redis.io/docs/clients/python/.

### Load Balancer

В качестве балансера рекомендуется использовать [https://www.nginx.com/](nginx).

Docker образ: https://hub.docker.com/_/nginx.

Пример конфиг файла, который распределяет нагрузку поровну между двумя инстансами (service-1, service-2):

```
http {
      proxy_read_timeout 60;
      proxy_connect_timeout 60;
      proxy_send_timeout 60;

      upstream mybackend {
         least_conn;
         server http://service-1:80;
         server http://service-2:80;
      }
      server {
         access_log /var/log/nginx/ls_service.log apm;
         client_max_body_size 64M;
         listen 80;
          location / {
                proxy_pass http://mybackend;
          }
          location  /nginx_status {
             stub_status;
          }
      }
   }
events {}

```

Этот конфиг необходимо положить в `/etc/nginx/nginx.conf`.
